
<!DOCTYPE html>
<html>
<head>
    <title>복약했수다</title>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang&family=Nanum+Gothic&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Nanum Gothic', sans-serif; /* 기본 폰트 */
            margin: 0;
            padding: 20px;
            background-color: #f5f5dc; /* 약간 바랜듯한 베이지 배경 */
            color: #3e2723; /* 짙은 갈색 글자색 */
            line-height: 1.6; /* 줄 간격 */
        }
        h1, h2 {
            font-family: 'Gowun Batang', serif; /* 제목 폰트 */
            color: #a1887f; /* 부드러운 갈색 제목색 */
            border-bottom: 2px solid #d7ccc8; /* 옅은 갈색 밑줄 */
            padding-bottom: 10px;
            margin-top: 20px;
        }
        form { /* 검색 폼 스타일 */
            margin-bottom: 30px;
            padding: 20px;
            background-color: #fff9c4; /* 옅은 노란색 배경 */
            border: 1px solid #d7ccc8;
            border-radius: 8px;
            display: inline-block; /* 내용만큼만 너비 차지 */
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1); /* 미세한 그림자 */
        }
        form label {
            font-weight: bold;
            margin-right: 10px;
            color: #5d4037; /* 라벨 색상 */
        }
        form input[type="text"] {
            padding: 8px;
            border: 1px solid #a1887f; /* 갈색 테두리 */
            border-radius: 4px;
            font-family: 'Nanum Gothic', sans-serif;
            font-size: 1rem;
             color: #3e2723; /* 입력 글자색 */
        }
         form button {
            padding: 8px 15px;
            background-color: #a1887f; /* 갈색 버튼 */
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Nanum Gothic', sans-serif;
            font-size: 1rem;
            transition: background-color 0.3s ease; /* 부드러운 호버 효과 */
        }
        form button:hover {
            background-color: #8d6e63; /* 호버 시 더 진한 갈색 */
        }
        /* 새롭게 추가된 상호작용 확인 폼 스타일 */
        form.interaction-form {
             margin-top: 20px;
             margin-bottom: 20px;
             padding: 0;
             border: none;
             background: none;
        }
         form.interaction-form button {
             display: block;
             margin-top: 15px;
             padding: 10px 20px;
             background-color: #8bc34a; /* 초록색 버튼 */
             color: white;
             border: none;
             border-radius: 4px;
             cursor: pointer;
             font-family: 'Nanum Gothic', sans-serif;
             font-size: 1.05rem;
             transition: background-color 0.3s ease;
              box-shadow: 2px 2px 5px rgba(0,0,0,0.1); /* 미세한 그림자 */
         }
         form.interaction-form button:hover {
             background-color: #689f38;
         }


        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 0;
            background-color: #ffffff;
            border: 1px solid #d7ccc8;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1); /* 미세한 그림자 */
        }
        th, td {
            border: 1px solid #d7ccc8;
            padding: 12px;
            text-align: left;
            font-family: 'Nanum Gothic', sans-serif;
            font-size: 0.95rem;
            vertical-align: top; /* 셀 내용 상단 정렬 */
            word-break: break-word; /* 셀 너비 넘어가는 긴 단어 줄바꿈 */
        }
        /* 긴 텍스트 컬럼의 줄바꿈 및 공백 유지 */
        td:nth-child(4), /* 효능/효과 컬럼 */
        td:nth-child(5) { /* 용법/용량 컬럼 */
             white-space: pre-wrap; /* 공백 및 줄바꿈 유지 */
        }


        th {
            background-color: #dcedc8;
            color: #3e2723;
            font-weight: bold;
            font-family: 'Gowun Batang', serif;
        }
        tr:nth-child(even) {
            background-color: #fffcf2;
        }
        /* 링크 스타일 (상세 페이지 이동 링크) */
        td a {
            color: #5d4037;
            text-decoration: none;
            font-weight: bold;
        }
        td a:hover {
            text-decoration: underline;
            color: #3e2723;
        }
         p { /* 검색 결과 개수 또는 결과 없음 메시지 스타일 */
            font-family: 'Nanum Gothic', sans-serif;
            font-size: 1rem;
            color: #5d4037;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        /* 체크박스 컬럼 너비 조절 */
        th:first-child, td:first-child {
            width: 50px;
            text-align: center;
            vertical-align: middle;
        }
        td:first-child input[type="checkbox"] {
             transform: scale(1.2);
             cursor: pointer;
        }

        .home-button {
            display: inline-block;
            margin-top: 30px; /* 위쪽 여백 */
            padding: 10px 20px;
            background-color: #a1887f; /* 따뜻한 갈색 (home.html의 푸터나 테두리 색상과 유사) */
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            font-family: 'Nanum Gothic', sans-serif; /* 폰트도 통일 */
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2); /* 그림자 추가 */
        }
        .home-button:hover {
            background-color: #8d6e63; /* 호버 시 더 진한 색 */
            transform: translateY(-2px); /* 살짝 위로 */
        }

         /* 푸터 스타일 */
         .footer {
             margin-top: 40px;
             text-align: center;
             font-size: 0.85rem;
             color: #8d6e63;
         }

        /* --- 페이지네이션 스타일 시작 --- */
        .pagination {
            display: flex; /* 요소들을 가로로 나열 */
            justify-content: center; /* 가운데 정렬 */
            align-items: center; /* 세로 가운데 정렬 */
            margin-top: 20px;
            padding: 10px 0;
            background-color: #fff9c4;
            border-radius: 8px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
        }
        .pagination a, .pagination span {
            display: inline-block; /* 링크와 현재 페이지 번호를 블록 요소처럼 */
            padding: 8px 12px;
            margin: 0 4px;
            text-decoration: none;
            color: #5d4037;
            border: 1px solid #d7ccc8;
            border-radius: 4px;
            transition: background-color 0.3s ease;
            font-weight: bold;
            font-size: 0.9rem;
        }
        .pagination a:hover {
            background-color: #e0e0e0;
            border-color: #a1887f;
        }
        .pagination .current-page {
            background-color: #a1887f; /* 현재 페이지 강조 */
            color: white;
            border-color: #a1887f;
            cursor: default; /* 클릭 불가능하게 */
        }
        .pagination .disabled {
            color: #ccc;
            border-color: #eee;
            cursor: not-allowed; /* 클릭 불가능하게 */
            background-color: #f9f9f9;
        }
        /* --- 페이지네이션 스타일 끝 --- */

    </style>
</head>
<body>
    <h1>복약했수다</h1>
    <form action="/search" method="get">
        <label for="query">약 이름, 품목코드 또는 증상 검색:</label>
        <input type="text" id="query" name="query" value="{{ query | default('') }}" required>
        <button type="submit">검색</button>
    </form>

    <h2>검색 결과</h2>
    {% if drugs %}
        <p>총 {{ total_count }} 건의 결과가 있습니다. (현재 {{ page }} / {{ (total_count / per_page) | round(0, 'ceil') | int }} 페이지)</p>

        <form action="/check_interactions" method="post" class="interaction-form">
            <table>
                <thead>
                    <tr>
                        <th>선택</th>
                        <th>제품명</th>
                        <th>업체명</th>
                        <th>효능/효과</th>
                        <th>용법/용량</th>
                        </tr>
                </thead>
                <tbody>
                    {% for drug in drugs %}
                    <tr>
                        <td><input type="checkbox" name="item_codes" value="{{ drug.item_code }}"></td>
                        <td><a href="/drug/{{ drug.item_code }}">{{ drug.product_name }}</a></td>
                        <td>{{ drug.company_name }}</td>
                        <td>{{ drug.efficacy | default('정보 없음') }}</td>
                        <td>{{ drug.howtouse | default('정보 없음') }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            <button type="submit">선택 항목 주의사항 확인</button>
        </form>

        {# --- 페이지네이션 UI 시작 --- #}
        {% if total_count > per_page %} {# 전체 결과가 페이지당 항목 수보다 많을 때만 페이지네이션 표시 #}
        <div class="pagination">
            {% set total_pages = (total_count / per_page) | round(0, 'ceil') | int %} {# 총 페이지 수 계산 #}

            {# 이전 페이지 버튼 #}
            {% if page > 1 %}
                <a href="{{ url_for('search', query=query, page=page-1, per_page=per_page) }}">&laquo; 이전</a>
            {% else %}
                <span class="disabled">&laquo; 이전</span>
            {% endif %}

            {# 페이지 번호 링크 (현재 페이지 주변 5개만 표시) #}
            {% for p in range(1, total_pages + 1) %}
                {% if p >= page - 2 and p <= page + 2 %} {# 현재 페이지를 기준으로 좌우 2개씩만 표시 #}
                    {% if p == page %}
                        <span class="current-page">{{ p }}</span> {# 현재 페이지는 링크 대신 강조 #}
                    {% else %}
                        <a href="{{ url_for('search', query=query, page=p, per_page=per_page) }}">{{ p }}</a>
                    {% endif %}
                {% elif (p == 1 and page > 3) or (p == total_pages and page < total_pages - 2) %} {# 처음 또는 마지막 페이지 번호 표시 #}
                    {# 첫 페이지가 너무 멀리 떨어져있거나 마지막 페이지가 너무 멀리 떨어져있을때 ... 표시 #}
                    {% if p == 1 and page > 3 and page != 4 %} {# 1페이지가 3칸이상 떨어져있고 4페이지가 아니면 ... #}
                        <a href="{{ url_for('search', query=query, page=1, per_page=per_page) }}">1</a>
                        {% if page > 4 %}<span class="disabled">...</span>{% endif %}
                    {% elif p == total_pages and page < total_pages - 2 and page != total_pages - 3 %} {# 마지막 페이지가 너무 멀리 떨어져있고 그 전 페이지가 아니면 ... #}
                        {% if page < total_pages - 3 %}<span class="disabled">...</span>{% endif %}
                        <a href="{{ url_for('search', query=query, page=total_pages, per_page=per_page) }}">{{ total_pages }}</a>
                    {% endif %}
                {% endif %}
            {% endfor %}

            {# 다음 페이지 버튼 #}
            {% if page < total_pages %}
                <a href="{{ url_for('search', query=query, page=page+1, per_page=per_page) }}">다음 &raquo;</a>
            {% else %}
                <span class="disabled">다음 &raquo;</span>
            {% endif %}
        </div>
        {% endif %}
        {# --- 페이지네이션 UI 끝 --- #}

    {% elif query %}
        <p>'{{ query }}'에 대한 검색 결과가 없습니다.</p>
    {% endif %}
    
    <div style="text-align: center; margin-top: 30px;">
        <a href="/" class="home-button">첫 시작 페이지로 돌아가기</a>
    </div>

    <div class="footer">
        <p>&copy; 2025 복약했수다. Data provided by Korea Ministry of Food and Drug Safety.</p>
    </div>

</body>
</html>